/*! For license information please see 5727.js.LICENSE.txt */
(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[5727],{"./src/stores/BreadcrumbsStore.ts":(e,n,t)=>{"use strict";t.d(n,{Y:()=>d});var o,r=t("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=t("./node_modules/matrix-js-sdk/src/matrix.ts"),i=t("./node_modules/matrix-js-sdk/src/types.ts"),l=t("./node_modules/matrix-js-sdk/src/utils.ts"),a=t("./src/settings/SettingsStore.ts"),_=t("./src/stores/AsyncStoreWithClient.ts"),c=t("./src/dispatcher/dispatcher.ts"),u=t("./src/utils/arrays.ts"),p=t("./src/settings/SettingLevel.ts"),m=t("./src/dispatcher/actions.ts");class d extends _.r{constructor(){super(c.A),(0,r.A)(this,"waitingRooms",[]),(0,r.A)(this,"onMyMembership",(async e=>{const n=a.A.getValue("breadcrumbs",null,!0);this.meetsRoomRequirement&&(0,l.hX)(n)&&await a.A.setValue("breadcrumbs",null,p.p.ACCOUNT,!0)})),(0,r.A)(this,"onRoom",(async e=>{const n=this.waitingRooms.find((n=>n.roomId===e.roomId));n&&(this.waitingRooms.splice(this.waitingRooms.indexOf(n),1),Date.now()-n.addedTs>9e4||await this.appendRoom(e))})),a.A.monitorSetting("breadcrumb_rooms",null),a.A.monitorSetting("breadcrumbs",null)}static get instance(){return d.internalInstance}get rooms(){return this.state.rooms||[]}get visible(){return!!this.state.enabled&&this.meetsRoomRequirement}get meetsRoomRequirement(){const e=a.A.getValue("feature_dynamic_room_predecessors");return!!this.matrixClient&&this.matrixClient.getVisibleRooms(e).length>=20}async onAction(e){if(this.matrixClient)if(e.action===m.r.SettingUpdated)"breadcrumb_rooms"===e.settingName?await this.updateRooms():"breadcrumbs"===e.settingName&&await this.updateState({enabled:a.A.getValue("breadcrumbs",null)});else if(e.action===m.r.ViewRoom)if(e.auto_join&&e.room_id&&!this.matrixClient.getRoom(e.room_id))this.waitingRooms.push({roomId:e.room_id,addedTs:Date.now()});else{const n=this.matrixClient.getRoom(e.room_id),t=null==n?void 0:n.getMyMembership();n&&t===i.O.Join&&await this.appendRoom(n)}else if(e.action===m.r.JoinRoom){const n=this.matrixClient.getRoom(e.roomId);n&&await this.appendRoom(n)}}async onReady(){await this.updateRooms(),await this.updateState({enabled:a.A.getValue("breadcrumbs",null)}),this.matrixClient&&(this.matrixClient.on(s.RoomEvent.MyMembership,this.onMyMembership),this.matrixClient.on(s.ClientEvent.Room,this.onRoom))}async onNotReady(){this.matrixClient&&(this.matrixClient.removeListener(s.RoomEvent.MyMembership,this.onMyMembership),this.matrixClient.removeListener(s.ClientEvent.Room,this.onRoom))}async updateRooms(){let e=a.A.getValue("breadcrumb_rooms");e&&0!==e.length||(e=[]);const n=(0,u.Bo)(e.map((e=>{var n;return null===(n=this.matrixClient)||void 0===n?void 0:n.getRoom(e)}))),t=this.state.rooms||[];(0,u.dc)(n,t)&&await this.updateState({rooms:n})}async appendRoom(e){var n;let t=!1;const o=(this.state.rooms||[]).slice(),r=a.A.getValue("feature_dynamic_room_predecessors"),s=null===(n=this.matrixClient)||void 0===n?void 0:n.getRoomUpgradeHistory(e.roomId,!1,r);if(s&&s.length>1){e=s[s.length-1];for(let e=0;e<s.length-1;e++){const n=o.findIndex((n=>n.roomId===s[e].roomId));-1!==n&&(o.splice(n,1),t=!0)}}const i=o.findIndex((n=>n.roomId===e.roomId));if(0!==i&&(-1!==i&&o.splice(i,1),o.splice(0,0,e),t=!0),o.length>20&&(o.splice(20,o.length-20),t=!0),t){await this.updateState({rooms:o});const e=o.map((e=>e.roomId));e.length>0&&await a.A.setValue("breadcrumb_rooms",null,p.p.ACCOUNT,e)}}}o=d,(0,r.A)(d,"internalInstance",(()=>{const e=new o;return e.start(),e})())},"./src/vector/init.tsx":(e,n,t)=>{"use strict";t.d(n,{_t:()=>_._t,extractErrorMessageFromError:()=>le.$,loadApp:()=>he,loadConfig:()=>ue,loadLanguage:()=>me,loadModules:()=>fe,loadOlm:()=>pe,loadTheme:()=>de,preparePlatform:()=>_e,rageshakePromise:()=>ae,setupLogStorage:()=>ce,showError:()=>ye,showIncompatibleBrowser:()=>ge});const o=t.p+"olm.aab9861.wasm";var r=t("./node_modules/@matrix-org/olm/olm.js"),s=t.n(r),i=t("./node_modules/react-dom/client.js"),l=t("./node_modules/react/index.js"),a=t("./node_modules/matrix-js-sdk/src/logger.ts"),_=t("./src/languageHandler.tsx"),c=t("./src/settings/SettingsStore.ts"),u=t("./src/PlatformPeg.ts"),p=t("./src/SdkConfig.ts"),m=t("./src/theme.ts"),d=t("./src/modules/ModuleRunner.ts"),h=t("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),y=t("./node_modules/matrix-js-sdk/src/randomstring.ts"),g=t("./src/BasePlatform.ts"),f=t("./src/dispatcher/dispatcher.ts"),b=t("./src/rageshake/rageshake.ts"),k=t("./src/Modal.tsx"),v=t("./src/components/views/dialogs/InfoDialog.tsx"),w=t("./src/components/views/elements/Spinner.tsx"),A=t("./src/dispatcher/actions.ts"),S=t("./src/toasts/UpdateToast.tsx"),x=t("./src/stores/ToastStore.ts"),C=t("./src/components/views/toasts/GenericToast.tsx"),E=t("./src/hooks/useTimeout.ts");const $=({description:e,primaryLabel:n,dismissLabel:t,onPrimaryClick:o,onDismiss:r,toastKey:s,numSeconds:i})=>{const a=()=>{r&&r(),x.A.sharedInstance().dismissToast(s)},_=(0,E.kD)(a,1e3,i);let c=t;return _>0&&(c+=` (${_})`),l.createElement(C.A,{description:e,primaryLabel:n,onPrimaryClick:o,secondaryLabel:c,onSecondaryClick:a})};var U=t("./src/stores/BreadcrumbsStore.ts"),I=t("./src/stores/AsyncStore.ts"),O=t("./src/Avatar.ts"),P=t("./node_modules/classnames/index.js"),R=t.n(P),M=t("./src/components/views/dialogs/BaseDialog.tsx"),T=t("./src/components/views/elements/DialogButtons.tsx"),D=t("./src/components/views/elements/AccessibleButton.tsx"),L=t("./src/components/structures/TabbedView.tsx");function j(){const e=u.A.get();return e?null==e?void 0:e.getDesktopCapturerSources({thumbnailSize:{height:176,width:312},types:["screen","window"]}):Promise.resolve([])}let N=function(e){return e.Screens="screen",e.Windows="window",e}({});class V extends l.Component{constructor(...e){super(...e),(0,h.A)(this,"onClick",(()=>{this.props.onSelect(this.props.source)}))}render(){const e=R()({mx_desktopCapturerSourcePicker_source_thumbnail:!0,mx_desktopCapturerSourcePicker_source_thumbnail_selected:this.props.selected});return l.createElement(D.A,{className:"mx_desktopCapturerSourcePicker_source",title:this.props.source.name,onClick:this.onClick},l.createElement("img",{alt:this.props.source.name,className:e,src:this.props.source.thumbnailURL}),l.createElement("span",{className:"mx_desktopCapturerSourcePicker_source_name"},this.props.source.name))}}class B extends l.Component{constructor(e){super(e),(0,h.A)(this,"interval",void 0),(0,h.A)(this,"onSelect",(e=>{this.setState({selectedSource:e})})),(0,h.A)(this,"onShare",(()=>{this.props.onFinished(this.state.selectedSource)})),(0,h.A)(this,"onTabChange",(e=>{this.setState({selectedSource:void 0,selectedTab:e})})),(0,h.A)(this,"onCloseClick",(()=>{this.props.onFinished()})),this.state={selectedTab:N.Screens,sources:[]}}async componentDidMount(){this.setState({sources:await j()}),this.interval=window.setInterval((async()=>{this.setState({sources:await j()})}),500)}componentWillUnmount(){clearInterval(this.interval)}getTab(e,n){const t=this.state.sources.filter((n=>n.id.startsWith(e))).map((e=>{var n;return l.createElement(V,{selected:(null===(n=this.state.selectedSource)||void 0===n?void 0:n.id)===e.id,source:e,onSelect:this.onSelect,key:e.id})}));return new L.oz(e,n,null,l.createElement("div",{className:"mx_desktopCapturerSourcePicker_tab"},t))}render(){const e=[this.getTab(N.Screens,(0,_.AO)("voip|screenshare_monitor")),this.getTab(N.Windows,(0,_.AO)("voip|screenshare_window"))];return l.createElement(M.A,{className:"mx_desktopCapturerSourcePicker",onFinished:this.onCloseClick,title:(0,_._t)("voip|screenshare_title")},l.createElement(L.Ay,{tabs:e,tabLocation:L.lX.TOP,activeTabId:this.state.selectedTab,onChange:this.onTabChange}),l.createElement(T.A,{primaryButton:(0,_._t)("action|share"),hasCancel:!0,onCancel:this.onCloseClick,onPrimaryButtonClick:this.onShare,primaryDisabled:!this.state.selectedSource}))}}var W=t("./src/MatrixClientPeg.ts");class z{async supportsEventIndexing(){return!0}async initEventIndex(e,n){throw new Error("Unimplemented")}async addEventToIndex(e,n){throw new Error("Unimplemented")}async deleteEvent(e){throw new Error("Unimplemented")}async isEventIndexEmpty(){throw new Error("Unimplemented")}isRoomIndexed(e){throw new Error("Unimplemented")}async getStats(){throw new Error("Unimplemented")}async getUserVersion(){throw new Error("Unimplemented")}async setUserVersion(e){throw new Error("Unimplemented")}async commitLiveEvents(){throw new Error("Unimplemented")}async searchEventIndex(e){throw new Error("Unimplemented")}async addHistoricEvents(e,n,t){throw new Error("Unimplemented")}async addCrawlerCheckpoint(e){throw new Error("Unimplemented")}async removeCrawlerCheckpoint(e){throw new Error("Unimplemented")}async loadCheckpoints(){throw new Error("Unimplemented")}async loadFileEvents(e){throw new Error("Unimplemented")}async closeEventIndex(){throw new Error("Unimplemented")}async deleteEventIndex(){throw new Error("Unimplemented")}}var F=t("./node_modules/matrix-js-sdk/src/utils.ts");class H{constructor(e="ipcCall",n="ipcReply"){if((0,h.A)(this,"pendingIpcCalls",{}),(0,h.A)(this,"nextIpcCallId",0),(0,h.A)(this,"onIpcReply",((e,n)=>{if(void 0===n.id)return void a.v.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[n.id])return void a.v.warn("Unknown IPC payload ID: "+n.id);const t=this.pendingIpcCalls[n.id];delete this.pendingIpcCalls[n.id],n.error?t.reject(n.error):t.resolve(n.reply)})),this.sendChannel=e,this.recvChannel=n,!window.electron)throw new Error("Cannot instantiate ElectronPlatform, window.electron is not set");window.electron.on(this.recvChannel,this.onIpcReply)}async call(e,...n){const t=++this.nextIpcCallId,o=(0,F.v6)();return this.pendingIpcCalls[t]=o,window.electron.send(this.sendChannel,{id:t,name:e,args:n}),o.promise}}class K extends z{constructor(...e){super(...e),(0,h.A)(this,"ipc",new H("seshat","seshatReply"))}async supportsEventIndexing(){return this.ipc.call("supportsEventIndexing")}async initEventIndex(e,n){return this.ipc.call("initEventIndex",e,n)}async addEventToIndex(e,n){return this.ipc.call("addEventToIndex",e,n)}async deleteEvent(e){return this.ipc.call("deleteEvent",e)}async isEventIndexEmpty(){return this.ipc.call("isEventIndexEmpty")}async isRoomIndexed(e){return this.ipc.call("isRoomIndexed",e)}async commitLiveEvents(){return this.ipc.call("commitLiveEvents")}async searchEventIndex(e){return this.ipc.call("searchEventIndex",e)}async addHistoricEvents(e,n,t){return this.ipc.call("addHistoricEvents",e,n,t)}async addCrawlerCheckpoint(e){return this.ipc.call("addCrawlerCheckpoint",e)}async removeCrawlerCheckpoint(e){return this.ipc.call("removeCrawlerCheckpoint",e)}async loadFileEvents(e){return this.ipc.call("loadFileEvents",e)}async loadCheckpoints(){return this.ipc.call("loadCheckpoints")}async closeEventIndex(){return this.ipc.call("closeEventIndex")}async getStats(){return this.ipc.call("getStats")}async getUserVersion(){return this.ipc.call("getUserVersion")}async setUserVersion(e){return this.ipc.call("setUserVersion",e)}async deleteEventIndex(){return this.ipc.call("deleteEventIndex")}}function q(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function G(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?q(Object(t),!0).forEach((function(n){(0,h.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):q(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const J="element-desktop-ssoid",X=navigator.platform.toUpperCase().includes("MAC");function Y(e){["call_state"].includes(e.action)&&window.electron.send("app_onAction",e)}class Q extends g.Ay{constructor(){if(super(),(0,h.A)(this,"ipc",new H("ipcCall","ipcReply")),(0,h.A)(this,"eventIndexManager",new K),(0,h.A)(this,"ssoID",(0,y.DU)(32)),(0,h.A)(this,"onBreadcrumbsUpdate",(()=>{const e=U.Y.instance.rooms.slice(0,7).map((e=>({roomId:e.roomId,avatarUrl:(0,O.ze)(e,Math.floor(60*window.devicePixelRatio),Math.floor(60*window.devicePixelRatio),"crop"),initial:(0,O.$R)(e.name)})));this.ipc.call("breadcrumbs",e)})),(0,h.A)(this,"onUpdateDownloaded",(async(e,{releaseNotes:n,releaseName:t})=>{f.A.dispatch({action:A.r.CheckUpdates,status:g.Kn.Ready}),this.shouldShowUpdate(t)&&(0,S.P)(await this.getAppVersion(),t,n)})),!window.electron)throw new Error("Cannot instantiate ElectronPlatform, window.electron is not set");f.A.register(Y),window.electron.on("check_updates",((e,n)=>{f.A.dispatch(G({action:A.r.CheckUpdates},function(e){return!0===e?{status:g.Kn.Downloading}:!1===e?{status:g.Kn.NotAvailable}:{status:g.Kn.Error,detail:e}}(n)))})),window.electron.on("userAccessToken",(()=>{var e;window.electron.send("userAccessToken",null===(e=W.J.get())||void 0===e?void 0:e.getAccessToken())})),window.electron.on("homeserverUrl",(()=>{var e;window.electron.send("homeserverUrl",null===(e=W.J.get())||void 0===e?void 0:e.getHomeserverUrl())})),window.electron.on("serverSupportedVersions",(async()=>{var e;window.electron.send("serverSupportedVersions",await(null===(e=W.J.get())||void 0===e?void 0:e.getVersions()))})),window.electron.on("before-quit",(function(){a.v.log("element-desktop closing"),b.bX()})),window.electron.on("update-downloaded",this.onUpdateDownloaded),window.electron.on("preferences",(()=>{f.A.fire(A.r.ViewUserSettings)})),window.electron.on("userDownloadCompleted",((e,{id:n,name:t})=>{const o=`DOWNLOAD_TOAST_${n}`;x.A.sharedInstance().addOrReplaceToast({key:o,title:(0,_._t)("download_completed"),props:{description:t,primaryLabel:(0,_._t)("action|open"),onPrimaryClick:()=>{window.electron.send("userDownloadAction",{id:n,open:!0}),x.A.sharedInstance().dismissToast(o)},dismissLabel:(0,_._t)("action|dismiss"),onDismiss:()=>{window.electron.send("userDownloadAction",{id:n})},numSeconds:10},component:$,priority:99})})),window.electron.on("openDesktopCapturerSourcePicker",(async()=>{const{finished:e}=k.Ay.createDialog(B),[n]=await e;await this.ipc.call("callDisplayMediaCallback",null!=n?n:{id:"",name:"",thumbnailURL:""})})),this.ipc.call("startSSOFlow",this.ssoID),U.Y.instance.on(I.H,this.onBreadcrumbsUpdate)}async getConfig(){return this.ipc.call("getConfig")}getHumanReadableName(){return"Electron Platform"}supportsSpellCheckSettings(){return!0}allowOverridingNativeContextMenus(){return!0}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),window.electron.send("setBadgeCount",e))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(e,n,t,o,r){navigator.userAgent.includes("Linux")&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const s=super.displayNotification(e,n,t,o,r),i=s.onclick;return s.onclick=()=>{null==i||i(),this.ipc.call("focusWindow")},s}loudNotification(e,n){window.electron.send("loudNotification")}needsUrlTooltips(){return!0}async getAppVersion(){return this.ipc.call("getAppVersion")}supportsSetting(e){switch(e){case"Electron.showTrayIcon":case"Electron.alwaysShowMenuBar":return!X;default:return!0}}getSettingValue(e){return this.ipc.call("getSettingValue",e)}setSettingValue(e,n){return this.ipc.call("setSettingValue",e,n)}async canSelfUpdate(){const e=await this.ipc.call("getUpdateFeedUrl");return Boolean(e)}startUpdateCheck(){super.startUpdateCheck(),window.electron.send("check_updates")}installUpdate(){window.electron.send("install_update")}getDefaultDeviceDisplayName(){const e=p.Ay.get().brand;return(0,_._t)("desktop_default_device_name",{brand:e,platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload()}getEventIndexingManager(){return this.eventIndexManager}async setLanguage(e){return this.ipc.call("setLanguage",e)}setSpellCheckEnabled(e){this.ipc.call("setSpellCheckEnabled",e).catch((e=>{a.v.log("Failed to send setSpellCheckEnabled IPC to Electron"),a.v.error(e)}))}async getSpellCheckEnabled(){return this.ipc.call("getSpellCheckEnabled")}setSpellCheckLanguages(e){this.ipc.call("setSpellCheckLanguages",e).catch((e=>{a.v.log("Failed to send setSpellCheckLanguages IPC to Electron"),a.v.error(e)}))}async getSpellCheckLanguages(){return this.ipc.call("getSpellCheckLanguages")}async getDesktopCapturerSources(e){return this.ipc.call("getDesktopCapturerSources",e)}supportsDesktopCapturer(){return!0}supportsJitsiScreensharing(){return!1}async getAvailableSpellCheckLanguages(){return this.ipc.call("getAvailableSpellCheckLanguages")}getSSOCallbackUrl(e){const n=super.getSSOCallbackUrl(e);return n.protocol="element",n.searchParams.set(J,this.ssoID),n}startSingleSignOn(e,n,t,o){super.startSingleSignOn(e,n,t,o),k.Ay.createDialog(v.A,{title:(0,_._t)("auth|sso_complete_in_browser_dialog_title"),description:l.createElement(w.A,null)})}navigateForwardBack(e){this.ipc.call(e?"navigateBack":"navigateForward")}overrideBrowserShortcuts(){return!0}async getPickleKey(e,n){try{return await this.ipc.call("getPickleKey",e,n)}catch{return null}}async createPickleKey(e,n){try{return await this.ipc.call("createPickleKey",e,n)}catch{return null}}async destroyPickleKey(e,n){try{await this.ipc.call("destroyPickleKey",e,n)}catch{}}async clearStorage(){try{await super.clearStorage(),await this.ipc.call("clearStorage")}catch{}}get baseUrl(){var e;return null!==(e=p.Ay.get().web_base_url)&&void 0!==e?e:"https://app.element.io"}get defaultOidcClientUri(){return"https://element.io"}async getOidcClientMetadata(){return G(G({},await super.getOidcClientMetadata()),{},{applicationType:"native"})}getOidcClientState(){return`:${J}:${this.ssoID}`}getOidcCallbackUrl(){const e=super.getOidcCallbackUrl();return e.protocol="io.element.desktop",e.href.startsWith(`${e.protocol}://`)&&(e.href=e.href.replace("://",":/")),e}}var Z=t("./node_modules/ua-parser-js/src/ua-parser.js"),ee=t.n(Z),ne=t("./src/vector/url_utils.ts");function te(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function oe(e){return/^v\d+.\d+.\d+(-.+)?$/.test(e)?e.substring(1):e}class re extends g.Ay{constructor(){super(),(0,h.A)(this,"pollForUpdate",((e,n)=>this.getMostRecentVersion().then((t=>{const o=oe(re.VERSION);return o!==t?(this.shouldShowUpdate(t)?(console.log("Update available to "+t+", will notify user"),e(o,t)):console.log("Update available to "+t+" but won't be shown"),{status:g.Kn.Ready}):(console.log("No update available, already on "+t),null==n||n(),{status:g.Kn.NotAvailable})}),(e=>(a.v.error("Failed to poll for update",e),{status:g.Kn.Error,detail:e.message||(e.status?e.status.toString():"Unknown Error")}))))),this.tryRegisterServiceWorker().catch((e=>console.error("Error registering/updating service worker:",e)))}async tryRegisterServiceWorker(){if(!("serviceWorker"in navigator))return;const e=await navigator.serviceWorker.register("sw.js");e&&(navigator.serviceWorker.addEventListener("message",this.onServiceWorkerPostMessage.bind(this)),await e.update())}onServiceWorkerPostMessage(e){try{var n,t;if("userinfo"===(null===(n=e.data)||void 0===n?void 0:n.type)&&null!==(t=e.data)&&void 0!==t&&t.responseKey){var o;const n=localStorage.getItem("mx_user_id"),t=localStorage.getItem("mx_device_id"),r=null===(o=W.J.get())||void 0===o?void 0:o.getHomeserverUrl();e.source.postMessage({responseKey:e.data.responseKey,userId:n,deviceId:t,homeserver:r})}}catch(e){console.error("Error responding to service worker: ",e)}}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(e,n){window.Notification.requestPermission((n=>{e(n)})).catch(n)}))}async getMostRecentVersion(){const e=await fetch("version",{method:"GET",cache:"no-cache"});if(e.ok){return oe((await e.text()).trim())}return Promise.reject({status:e.status})}getAppVersion(){return Promise.resolve(oe(re.VERSION))}startUpdater(){console.log("startUpdater, current version is "+oe(re.VERSION)),this.pollForUpdate(((e,n)=>{if((0,ne.u)(location).updated)return console.log("Update reloaded but still on an old version, stopping"),void(0,S.P)(e,n);const t=new URL(window.location.href);t.searchParams.set("updated",n),console.log("Update reloading to "+t.toString()),window.location.href=t.toString()})),setInterval((()=>this.pollForUpdate(S.P,S.Y)),6e5)}async canSelfUpdate(){return!0}startUpdateCheck(){super.startUpdateCheck(),this.pollForUpdate(S.P,S.Y).then((e=>{f.A.dispatch(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?te(Object(t),!0).forEach((function(n){(0,h.A)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):te(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({action:A.r.CheckUpdates},e))}))}installUpdate(){window.location.reload()}getDefaultDeviceDisplayName(){const e=new URL(window.location.href),n=[e.host,e.pathname.replace(/\/$/,"")].join(""),t=new(ee()),o=t.getBrowser().name||"unknown browser";let r=t.getOS().name||"unknown OS";return"Mac OS"===r&&(r="macOS"),(0,_._t)("web_default_device_name",{appName:n,browserName:o,osName:r})}reload(){window.location.reload()}}(0,h.A)(re,"VERSION","4.13.0");class se extends re{setNotificationCount(e){if(!navigator.setAppBadge)return super.setNotificationCount(e);this.notificationCount!==e&&(this.notificationCount=e,navigator.setAppBadge(e).catch((e=>{a.v.error("Failed to update PWA app badge",e)})))}}var ie=t("./src/rageshake/submit-rageshake.ts");window.mxSendRageshake=function(e,n){const t=p.Ay.get().bug_report_endpoint_url;t?(void 0===n&&(n=!0),e&&e.trim()?(0,ie.Ay)(t,{userText:e,sendLogs:n,progressCallback:a.v.log.bind(console)}).then((()=>{a.v.log("Bug report sent!")}),(e=>{a.v.error(e)})):a.v.error("Cannot send a rageshake without a message - please tell us what went wrong")):a.v.error("Cannot send a rageshake - no bug_report_endpoint_url configured")};var le=t("./src/components/views/dialogs/ErrorDialog.tsx");const ae=function(){const e=b.Ts(!1);return e.then((async()=>{a.v.log("Initialised rageshake."),a.v.log("To fix line numbers in Chrome: Meatball menu → Settings → Ignore list → Add /rageshake\\.ts & /logger\\.ts$"),window.addEventListener("beforeunload",(()=>{a.v.log("element-web closing"),b.bX()})),await b.tP()}),(e=>{a.v.error("Failed to initialise rageshake: "+e)})),e}();function _e(){window.electron?(a.v.log("Using Electron platform"),u.A.set(new Q)):window.matchMedia("(display-mode: standalone)").matches?(a.v.log("Using PWA platform"),u.A.set(new se)):(a.v.log("Using Web platform"),u.A.set(new re))}function ce(){return p.Ay.get().bug_report_endpoint_url?b.fd():(a.v.warn("No bug report endpoint set - logs will not be persisted"),Promise.resolve())}async function ue(){var e;const n=await(null===(e=u.A.get())||void 0===e?void 0:e.getConfig());n?p.Ay.put(n):p.Ay.reset()}function pe(){return s().init({locateFile:()=>o}).then((()=>{a.v.log("Using WebAssembly Olm")})).catch((e=>(a.v.log("Failed to load Olm: trying legacy version",e),new Promise(((e,n)=>{const t=document.createElement("script");t.src="olm_legacy.js",t.onload=e,t.onerror=n,document.body.appendChild(t)})).then((()=>window.Olm.init())).then((()=>{a.v.log("Using legacy Olm")})).catch((e=>{a.v.log("Both WebAssembly and asm.js Olm failed!",e)})))))}async function me(){const e=c.A.getValue("language",null,!0);let n=[];console.log("preflang :TCHAP:",e),e?n=[e]:n.push(..._.Ev("fr"));try{await _.xC(n),document.documentElement.setAttribute("lang",_.UK())}catch(e){a.v.error("Unable to set language",e)}}async function de(){return(0,m.Yl)()}async function he(e){const n=await Promise.all([t.e(1869),t.e(8841),t.e(3323),t.e(4613),t.e(2702)]).then(t.bind(t,"./src/vector/app.tsx"));const o=await n.loadApp(e,(function(e){window.matrixChat=e}));(0,i.H)(document.getElementById("matrixchat")).render(o)}async function ye(e,n){const{ErrorView:o}=await t.e(5607).then(t.bind(t,"./src/async-components/structures/ErrorView.tsx"));(0,i.H)(document.getElementById("matrixchat")).render(l.createElement(l.StrictMode,null,l.createElement(o,{title:e,messages:n})))}async function ge(e){const{UnsupportedBrowserView:n}=await t.e(5607).then(t.bind(t,"./src/async-components/structures/ErrorView.tsx"));(0,i.H)(document.getElementById("matrixchat")).render(l.createElement(l.StrictMode,null,l.createElement(n,{onAccept:e})))}async function fe(){const{INSTALLED_MODULES:e}=await Promise.all([t.e(3163),t.e(1377)]).then(t.bind(t,"./src/modules.ts"));for(const n of e)d.r.instance.registerModule((e=>new n(e)))}},"./node_modules/@matrix-org/olm/olm.js":function(e,n){var t,o,r,s,i,l,a=(i={},r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(r=r||__filename),l=function(n){var s,l,a,_;if(n=n||{},s||(s=void 0!==n?n:{}),s.ready=new Promise((function(e,n){l=e,a=n})),"undefined"!=typeof window)_=function(e){window.crypto.getRandomValues(e)};else{if(!e.exports)throw Error("Cannot find global to attach library to");var c=require("crypto");_=function(e){var n=c.randomBytes(e.length);e.set(n)}}if("undefined"!=typeof OLM_OPTIONS)for(var u in OLM_OPTIONS)OLM_OPTIONS.hasOwnProperty(u)&&(s[u]=OLM_OPTIONS[u]);s.onRuntimeInitialized=function(){Ae=s._olm_error(),i.PRIVATE_KEY_LENGTH=s._olm_pk_private_key_length(),t&&t()},s.onAbort=function(e){o&&o(e)};var p,m,d,h,y,g,f=Object.assign({},s),b="object"==typeof window,k="function"==typeof importScripts,v="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,w="";v?(w=k?require("path").dirname(w)+"/":__dirname+"/",g=()=>{y||(h=require("fs"),y=require("path"))},p=function(e,n){return g(),e=y.normalize(e),h.readFileSync(e,n?void 0:"utf8")},d=e=>((e=p(e,!0)).buffer||(e=new Uint8Array(e)),e),m=(e,n,t)=>{g(),e=y.normalize(e),h.readFile(e,(function(e,o){e?t(e):n(o.buffer)}))},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",(function(e){throw e})),process.on("unhandledRejection",(function(e){throw e})),s.inspect=function(){return"[Emscripten Module object]"}):(b||k)&&(k?w=self.location.href:"undefined"!=typeof document&&document.currentScript&&(w=document.currentScript.src),r&&(w=r),w=0!==w.indexOf("blob:")?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):"",p=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(null),n.responseText},k&&(d=e=>{var n=new XMLHttpRequest;return n.open("GET",e,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),m=(e,n,t)=>{var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onload=()=>{200==o.status||0==o.status&&o.response?n(o.response):t()},o.onerror=t,o.send(null)}),s.print||console.log.bind(console);var A,S=s.printErr||console.warn.bind(console);Object.assign(s,f),f=null,s.wasmBinary&&(A=s.wasmBinary),s.noExitRuntime,"object"!=typeof WebAssembly&&X("no native wasm support detected");var x,C,E,$,U,I,O,P,R,M=!1,T="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function D(e,n){if(e){var t=$,o=e+n;for(n=e;t[n]&&!(n>=o);)++n;if(16<n-e&&t.buffer&&T)e=T.decode(t.subarray(e,n));else{for(o="";e<n;){var r=t[e++];if(128&r){var s=63&t[e++];if(192==(224&r))o+=String.fromCharCode((31&r)<<6|s);else{var i=63&t[e++];65536>(r=224==(240&r)?(15&r)<<12|s<<6|i:(7&r)<<18|s<<12|i<<6|63&t[e++])?o+=String.fromCharCode(r):(r-=65536,o+=String.fromCharCode(55296|r>>10,56320|1023&r))}}else o+=String.fromCharCode(r)}e=o}}else e="";return e}function L(e,n,t,o){if(!(0<o))return 0;var r=t;o=t+o-1;for(var s=0;s<e.length;++s){var i=e.charCodeAt(s);if(55296<=i&&57343>=i&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),127>=i){if(t>=o)break;n[t++]=i}else{if(2047>=i){if(t+1>=o)break;n[t++]=192|i>>6}else{if(65535>=i){if(t+2>=o)break;n[t++]=224|i>>12}else{if(t+3>=o)break;n[t++]=240|i>>18,n[t++]=128|i>>12&63}n[t++]=128|i>>6&63}n[t++]=128|63&i}}return n[t]=0,t-r}function j(e,n,t){return L(e,$,n,t)}function N(e){for(var n=0,t=0;t<e.length;++t){var o=e.charCodeAt(t);127>=o?n++:2047>=o?n+=2:55296<=o&&57343>=o?(n+=4,++t):n+=3}return n}function V(){var e=x.buffer;C=e,s.HEAP8=E=new Int8Array(e),s.HEAP16=U=new Int16Array(e),s.HEAP32=I=new Int32Array(e),s.HEAPU8=$=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=O=new Uint32Array(e),s.HEAPF32=P=new Float32Array(e),s.HEAPF64=R=new Float64Array(e)}var B=[],W=[],z=[];function F(){var e=s.preRun.shift();B.unshift(e)}var H,K,q=0,G=null,J=null;function X(e){throw s.onAbort&&s.onAbort(e),S(e="Aborted("+e+")"),M=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),a(e),e}function Y(){return H.startsWith("data:application/octet-stream;base64,")}if(H="olm.wasm",!Y()){var Q=H;H=s.locateFile?s.locateFile(Q,w):w+Q}function Z(){var e=H;try{if(e==H&&A)return new Uint8Array(A);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(e){X(e)}}function ee(e){for(;0<e.length;)e.shift()(s)}function ne(e,n="i8"){switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":return E[0|e];case"i16":return U[e>>1];case"i32":case"i64":return I[e>>2];case"float":return P[e>>2];case"double":return R[e>>3];case"*":return O[e>>2];default:X("invalid type for getValue: "+n)}return null}function te(e){var n="i8";switch(n.endsWith("*")&&(n="*"),n){case"i1":case"i8":E[0|e]=0;break;case"i16":U[e>>1]=0;break;case"i32":I[e>>2]=0;break;case"i64":K=[0,0],I[e>>2]=K[0],I[e+4>>2]=K[1];break;case"float":P[e>>2]=0;break;case"double":R[e>>3]=0;break;case"*":O[e>>2]=0;break;default:X("invalid type for setValue: "+n)}}function oe(e,n,t){for(var o=0;o<e.length;++o)E[0|n++]=e.charCodeAt(o);t||(E[0|n]=0)}function re(e,n,t){return e=L(e,t=Array(0<t?t:N(e)+1),0,t.length),n&&(t.length=e),t}var se={b:function(e,n,t){$.copyWithin(e,n,n+t)},a:function(e){var n=$.length;if(2147483648<(e>>>=0))return!1;for(var t=1;4>=t;t*=2){var o=n*(1+.2/t);o=Math.min(o,e+100663296);var r=Math;o=Math.max(e,o),r=r.min.call(r,2147483648,o+(65536-o%65536)%65536);e:{try{x.grow(r-C.byteLength+65535>>>16),V();var s=1;break e}catch(e){}s=void 0}if(s)return!0}return!1}};!function(){function e(e){s.asm=e.exports,x=s.asm.c,V(),W.unshift(s.asm.d),q--,s.monitorRunDependencies&&s.monitorRunDependencies(q),0==q&&(null!==G&&(clearInterval(G),G=null),J&&(e=J,J=null,e()))}function n(n){e(n.instance)}function t(e){return function(){if(!A&&(b||k)){if("function"==typeof fetch&&!H.startsWith("file://"))return fetch(H,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+H+"'";return e.arrayBuffer()})).catch((function(){return Z()}));if(m)return new Promise((function(e,n){m(H,(function(n){e(new Uint8Array(n))}),n)}))}return Promise.resolve().then((function(){return Z()}))}().then((function(e){return WebAssembly.instantiate(e,o)})).then((function(e){return e})).then(e,(function(e){S("failed to asynchronously prepare wasm: "+e),X(e)}))}var o={a:se};if(q++,s.monitorRunDependencies&&s.monitorRunDependencies(q),s.instantiateWasm)try{return s.instantiateWasm(o,e)}catch(e){return S("Module.instantiateWasm callback failed with error: "+e),!1}(A||"function"!=typeof WebAssembly.instantiateStreaming||Y()||H.startsWith("file://")||v||"function"!=typeof fetch?t(n):fetch(H,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,o).then(n,(function(e){return S("wasm streaming compile failed: "+e),S("falling back to ArrayBuffer instantiation"),t(n)}))}))).catch(a)}(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.d).apply(null,arguments)},s._olm_get_library_version=function(){return(s._olm_get_library_version=s.asm.f).apply(null,arguments)},s._olm_error=function(){return(s._olm_error=s.asm.g).apply(null,arguments)},s._olm_account_last_error=function(){return(s._olm_account_last_error=s.asm.h).apply(null,arguments)},s.__olm_error_to_string=function(){return(s.__olm_error_to_string=s.asm.i).apply(null,arguments)},s._olm_account_last_error_code=function(){return(s._olm_account_last_error_code=s.asm.j).apply(null,arguments)},s._olm_session_last_error=function(){return(s._olm_session_last_error=s.asm.k).apply(null,arguments)},s._olm_session_last_error_code=function(){return(s._olm_session_last_error_code=s.asm.l).apply(null,arguments)},s._olm_utility_last_error=function(){return(s._olm_utility_last_error=s.asm.m).apply(null,arguments)},s._olm_utility_last_error_code=function(){return(s._olm_utility_last_error_code=s.asm.n).apply(null,arguments)},s._olm_account_size=function(){return(s._olm_account_size=s.asm.o).apply(null,arguments)},s._olm_session_size=function(){return(s._olm_session_size=s.asm.p).apply(null,arguments)},s._olm_utility_size=function(){return(s._olm_utility_size=s.asm.q).apply(null,arguments)},s._olm_account=function(){return(s._olm_account=s.asm.r).apply(null,arguments)},s._olm_session=function(){return(s._olm_session=s.asm.s).apply(null,arguments)},s._olm_utility=function(){return(s._olm_utility=s.asm.t).apply(null,arguments)},s._olm_clear_account=function(){return(s._olm_clear_account=s.asm.u).apply(null,arguments)},s._olm_clear_session=function(){return(s._olm_clear_session=s.asm.v).apply(null,arguments)},s._olm_clear_utility=function(){return(s._olm_clear_utility=s.asm.w).apply(null,arguments)},s._olm_pickle_account_length=function(){return(s._olm_pickle_account_length=s.asm.x).apply(null,arguments)},s._olm_pickle_session_length=function(){return(s._olm_pickle_session_length=s.asm.y).apply(null,arguments)},s._olm_pickle_account=function(){return(s._olm_pickle_account=s.asm.z).apply(null,arguments)},s._olm_pickle_session=function(){return(s._olm_pickle_session=s.asm.A).apply(null,arguments)},s._olm_unpickle_account=function(){return(s._olm_unpickle_account=s.asm.B).apply(null,arguments)},s._olm_unpickle_session=function(){return(s._olm_unpickle_session=s.asm.C).apply(null,arguments)},s._olm_create_account_random_length=function(){return(s._olm_create_account_random_length=s.asm.D).apply(null,arguments)},s._olm_create_account=function(){return(s._olm_create_account=s.asm.E).apply(null,arguments)},s._olm_account_identity_keys_length=function(){return(s._olm_account_identity_keys_length=s.asm.F).apply(null,arguments)},s._olm_account_identity_keys=function(){return(s._olm_account_identity_keys=s.asm.G).apply(null,arguments)},s._olm_account_signature_length=function(){return(s._olm_account_signature_length=s.asm.H).apply(null,arguments)},s._olm_account_sign=function(){return(s._olm_account_sign=s.asm.I).apply(null,arguments)},s._olm_account_one_time_keys_length=function(){return(s._olm_account_one_time_keys_length=s.asm.J).apply(null,arguments)},s._olm_account_one_time_keys=function(){return(s._olm_account_one_time_keys=s.asm.K).apply(null,arguments)},s._olm_account_mark_keys_as_published=function(){return(s._olm_account_mark_keys_as_published=s.asm.L).apply(null,arguments)},s._olm_account_max_number_of_one_time_keys=function(){return(s._olm_account_max_number_of_one_time_keys=s.asm.M).apply(null,arguments)},s._olm_account_generate_one_time_keys_random_length=function(){return(s._olm_account_generate_one_time_keys_random_length=s.asm.N).apply(null,arguments)},s._olm_account_generate_one_time_keys=function(){return(s._olm_account_generate_one_time_keys=s.asm.O).apply(null,arguments)},s._olm_account_generate_fallback_key_random_length=function(){return(s._olm_account_generate_fallback_key_random_length=s.asm.P).apply(null,arguments)},s._olm_account_generate_fallback_key=function(){return(s._olm_account_generate_fallback_key=s.asm.Q).apply(null,arguments)},s._olm_account_fallback_key_length=function(){return(s._olm_account_fallback_key_length=s.asm.R).apply(null,arguments)},s._olm_account_fallback_key=function(){return(s._olm_account_fallback_key=s.asm.S).apply(null,arguments)},s._olm_account_unpublished_fallback_key_length=function(){return(s._olm_account_unpublished_fallback_key_length=s.asm.T).apply(null,arguments)},s._olm_account_unpublished_fallback_key=function(){return(s._olm_account_unpublished_fallback_key=s.asm.U).apply(null,arguments)},s._olm_account_forget_old_fallback_key=function(){return(s._olm_account_forget_old_fallback_key=s.asm.V).apply(null,arguments)},s._olm_create_outbound_session_random_length=function(){return(s._olm_create_outbound_session_random_length=s.asm.W).apply(null,arguments)},s._olm_create_outbound_session=function(){return(s._olm_create_outbound_session=s.asm.X).apply(null,arguments)},s._olm_create_inbound_session=function(){return(s._olm_create_inbound_session=s.asm.Y).apply(null,arguments)},s._olm_create_inbound_session_from=function(){return(s._olm_create_inbound_session_from=s.asm.Z).apply(null,arguments)},s._olm_session_id_length=function(){return(s._olm_session_id_length=s.asm._).apply(null,arguments)},s._olm_session_id=function(){return(s._olm_session_id=s.asm.$).apply(null,arguments)},s._olm_session_has_received_message=function(){return(s._olm_session_has_received_message=s.asm.aa).apply(null,arguments)},s._olm_session_describe=function(){return(s._olm_session_describe=s.asm.ba).apply(null,arguments)},s._olm_matches_inbound_session=function(){return(s._olm_matches_inbound_session=s.asm.ca).apply(null,arguments)},s._olm_matches_inbound_session_from=function(){return(s._olm_matches_inbound_session_from=s.asm.da).apply(null,arguments)},s._olm_remove_one_time_keys=function(){return(s._olm_remove_one_time_keys=s.asm.ea).apply(null,arguments)},s._olm_encrypt_message_type=function(){return(s._olm_encrypt_message_type=s.asm.fa).apply(null,arguments)},s._olm_encrypt_random_length=function(){return(s._olm_encrypt_random_length=s.asm.ga).apply(null,arguments)},s._olm_encrypt_message_length=function(){return(s._olm_encrypt_message_length=s.asm.ha).apply(null,arguments)},s._olm_encrypt=function(){return(s._olm_encrypt=s.asm.ia).apply(null,arguments)},s._olm_decrypt_max_plaintext_length=function(){return(s._olm_decrypt_max_plaintext_length=s.asm.ja).apply(null,arguments)},s._olm_decrypt=function(){return(s._olm_decrypt=s.asm.ka).apply(null,arguments)},s._olm_sha256_length=function(){return(s._olm_sha256_length=s.asm.la).apply(null,arguments)},s._olm_sha256=function(){return(s._olm_sha256=s.asm.ma).apply(null,arguments)},s._olm_ed25519_verify=function(){return(s._olm_ed25519_verify=s.asm.na).apply(null,arguments)},s._olm_pk_encryption_last_error=function(){return(s._olm_pk_encryption_last_error=s.asm.oa).apply(null,arguments)},s._olm_pk_encryption_last_error_code=function(){return(s._olm_pk_encryption_last_error_code=s.asm.pa).apply(null,arguments)},s._olm_pk_encryption_size=function(){return(s._olm_pk_encryption_size=s.asm.qa).apply(null,arguments)},s._olm_pk_encryption=function(){return(s._olm_pk_encryption=s.asm.ra).apply(null,arguments)},s._olm_clear_pk_encryption=function(){return(s._olm_clear_pk_encryption=s.asm.sa).apply(null,arguments)},s._olm_pk_encryption_set_recipient_key=function(){return(s._olm_pk_encryption_set_recipient_key=s.asm.ta).apply(null,arguments)},s._olm_pk_key_length=function(){return(s._olm_pk_key_length=s.asm.ua).apply(null,arguments)},s._olm_pk_ciphertext_length=function(){return(s._olm_pk_ciphertext_length=s.asm.va).apply(null,arguments)},s._olm_pk_mac_length=function(){return(s._olm_pk_mac_length=s.asm.wa).apply(null,arguments)},s._olm_pk_encrypt_random_length=function(){return(s._olm_pk_encrypt_random_length=s.asm.xa).apply(null,arguments)},s._olm_pk_encrypt=function(){return(s._olm_pk_encrypt=s.asm.ya).apply(null,arguments)},s._olm_pk_decryption_last_error=function(){return(s._olm_pk_decryption_last_error=s.asm.za).apply(null,arguments)},s._olm_pk_decryption_last_error_code=function(){return(s._olm_pk_decryption_last_error_code=s.asm.Aa).apply(null,arguments)},s._olm_pk_decryption_size=function(){return(s._olm_pk_decryption_size=s.asm.Ba).apply(null,arguments)},s._olm_pk_decryption=function(){return(s._olm_pk_decryption=s.asm.Ca).apply(null,arguments)},s._olm_clear_pk_decryption=function(){return(s._olm_clear_pk_decryption=s.asm.Da).apply(null,arguments)},s._olm_pk_private_key_length=function(){return(s._olm_pk_private_key_length=s.asm.Ea).apply(null,arguments)},s._olm_pk_generate_key_random_length=function(){return(s._olm_pk_generate_key_random_length=s.asm.Fa).apply(null,arguments)},s._olm_pk_key_from_private=function(){return(s._olm_pk_key_from_private=s.asm.Ga).apply(null,arguments)},s._olm_pk_generate_key=function(){return(s._olm_pk_generate_key=s.asm.Ha).apply(null,arguments)},s._olm_pickle_pk_decryption_length=function(){return(s._olm_pickle_pk_decryption_length=s.asm.Ia).apply(null,arguments)},s._olm_pickle_pk_decryption=function(){return(s._olm_pickle_pk_decryption=s.asm.Ja).apply(null,arguments)},s._olm_unpickle_pk_decryption=function(){return(s._olm_unpickle_pk_decryption=s.asm.Ka).apply(null,arguments)},s._olm_pk_max_plaintext_length=function(){return(s._olm_pk_max_plaintext_length=s.asm.La).apply(null,arguments)},s._olm_pk_decrypt=function(){return(s._olm_pk_decrypt=s.asm.Ma).apply(null,arguments)},s._olm_pk_get_private_key=function(){return(s._olm_pk_get_private_key=s.asm.Na).apply(null,arguments)},s._olm_pk_signing_size=function(){return(s._olm_pk_signing_size=s.asm.Oa).apply(null,arguments)},s._olm_pk_signing=function(){return(s._olm_pk_signing=s.asm.Pa).apply(null,arguments)},s._olm_pk_signing_last_error=function(){return(s._olm_pk_signing_last_error=s.asm.Qa).apply(null,arguments)},s._olm_pk_signing_last_error_code=function(){return(s._olm_pk_signing_last_error_code=s.asm.Ra).apply(null,arguments)},s._olm_clear_pk_signing=function(){return(s._olm_clear_pk_signing=s.asm.Sa).apply(null,arguments)},s._olm_pk_signing_seed_length=function(){return(s._olm_pk_signing_seed_length=s.asm.Ta).apply(null,arguments)},s._olm_pk_signing_public_key_length=function(){return(s._olm_pk_signing_public_key_length=s.asm.Ua).apply(null,arguments)},s._olm_pk_signing_key_from_seed=function(){return(s._olm_pk_signing_key_from_seed=s.asm.Va).apply(null,arguments)},s._olm_pk_signature_length=function(){return(s._olm_pk_signature_length=s.asm.Wa).apply(null,arguments)},s._olm_pk_sign=function(){return(s._olm_pk_sign=s.asm.Xa).apply(null,arguments)},s._olm_inbound_group_session_size=function(){return(s._olm_inbound_group_session_size=s.asm.Ya).apply(null,arguments)},s._olm_inbound_group_session=function(){return(s._olm_inbound_group_session=s.asm.Za).apply(null,arguments)},s._olm_clear_inbound_group_session=function(){return(s._olm_clear_inbound_group_session=s.asm._a).apply(null,arguments)},s._olm_inbound_group_session_last_error=function(){return(s._olm_inbound_group_session_last_error=s.asm.$a).apply(null,arguments)},s._olm_inbound_group_session_last_error_code=function(){return(s._olm_inbound_group_session_last_error_code=s.asm.ab).apply(null,arguments)},s._olm_init_inbound_group_session=function(){return(s._olm_init_inbound_group_session=s.asm.bb).apply(null,arguments)},s._olm_import_inbound_group_session=function(){return(s._olm_import_inbound_group_session=s.asm.cb).apply(null,arguments)},s._olm_pickle_inbound_group_session_length=function(){return(s._olm_pickle_inbound_group_session_length=s.asm.db).apply(null,arguments)},s._olm_pickle_inbound_group_session=function(){return(s._olm_pickle_inbound_group_session=s.asm.eb).apply(null,arguments)},s._olm_unpickle_inbound_group_session=function(){return(s._olm_unpickle_inbound_group_session=s.asm.fb).apply(null,arguments)},s._olm_group_decrypt_max_plaintext_length=function(){return(s._olm_group_decrypt_max_plaintext_length=s.asm.gb).apply(null,arguments)},s._olm_group_decrypt=function(){return(s._olm_group_decrypt=s.asm.hb).apply(null,arguments)},s._olm_inbound_group_session_id_length=function(){return(s._olm_inbound_group_session_id_length=s.asm.ib).apply(null,arguments)},s._olm_inbound_group_session_id=function(){return(s._olm_inbound_group_session_id=s.asm.jb).apply(null,arguments)},s._olm_inbound_group_session_first_known_index=function(){return(s._olm_inbound_group_session_first_known_index=s.asm.kb).apply(null,arguments)},s._olm_inbound_group_session_is_verified=function(){return(s._olm_inbound_group_session_is_verified=s.asm.lb).apply(null,arguments)},s._olm_export_inbound_group_session_length=function(){return(s._olm_export_inbound_group_session_length=s.asm.mb).apply(null,arguments)},s._olm_export_inbound_group_session=function(){return(s._olm_export_inbound_group_session=s.asm.nb).apply(null,arguments)},s._olm_outbound_group_session_size=function(){return(s._olm_outbound_group_session_size=s.asm.ob).apply(null,arguments)},s._olm_outbound_group_session=function(){return(s._olm_outbound_group_session=s.asm.pb).apply(null,arguments)},s._olm_clear_outbound_group_session=function(){return(s._olm_clear_outbound_group_session=s.asm.qb).apply(null,arguments)},s._olm_outbound_group_session_last_error=function(){return(s._olm_outbound_group_session_last_error=s.asm.rb).apply(null,arguments)},s._olm_outbound_group_session_last_error_code=function(){return(s._olm_outbound_group_session_last_error_code=s.asm.sb).apply(null,arguments)},s._olm_pickle_outbound_group_session_length=function(){return(s._olm_pickle_outbound_group_session_length=s.asm.tb).apply(null,arguments)},s._olm_pickle_outbound_group_session=function(){return(s._olm_pickle_outbound_group_session=s.asm.ub).apply(null,arguments)},s._olm_unpickle_outbound_group_session=function(){return(s._olm_unpickle_outbound_group_session=s.asm.vb).apply(null,arguments)},s._olm_init_outbound_group_session_random_length=function(){return(s._olm_init_outbound_group_session_random_length=s.asm.wb).apply(null,arguments)},s._olm_init_outbound_group_session=function(){return(s._olm_init_outbound_group_session=s.asm.xb).apply(null,arguments)},s._olm_group_encrypt_message_length=function(){return(s._olm_group_encrypt_message_length=s.asm.yb).apply(null,arguments)},s._olm_group_encrypt=function(){return(s._olm_group_encrypt=s.asm.zb).apply(null,arguments)},s._olm_outbound_group_session_id_length=function(){return(s._olm_outbound_group_session_id_length=s.asm.Ab).apply(null,arguments)},s._olm_outbound_group_session_id=function(){return(s._olm_outbound_group_session_id=s.asm.Bb).apply(null,arguments)},s._olm_outbound_group_session_message_index=function(){return(s._olm_outbound_group_session_message_index=s.asm.Cb).apply(null,arguments)},s._olm_outbound_group_session_key_length=function(){return(s._olm_outbound_group_session_key_length=s.asm.Db).apply(null,arguments)},s._olm_outbound_group_session_key=function(){return(s._olm_outbound_group_session_key=s.asm.Eb).apply(null,arguments)},s._olm_sas_last_error=function(){return(s._olm_sas_last_error=s.asm.Fb).apply(null,arguments)},s._olm_sas_last_error_code=function(){return(s._olm_sas_last_error_code=s.asm.Gb).apply(null,arguments)},s._olm_sas_size=function(){return(s._olm_sas_size=s.asm.Hb).apply(null,arguments)},s._olm_sas=function(){return(s._olm_sas=s.asm.Ib).apply(null,arguments)},s._olm_clear_sas=function(){return(s._olm_clear_sas=s.asm.Jb).apply(null,arguments)},s._olm_create_sas_random_length=function(){return(s._olm_create_sas_random_length=s.asm.Kb).apply(null,arguments)},s._olm_create_sas=function(){return(s._olm_create_sas=s.asm.Lb).apply(null,arguments)},s._olm_sas_pubkey_length=function(){return(s._olm_sas_pubkey_length=s.asm.Mb).apply(null,arguments)},s._olm_sas_get_pubkey=function(){return(s._olm_sas_get_pubkey=s.asm.Nb).apply(null,arguments)},s._olm_sas_set_their_key=function(){return(s._olm_sas_set_their_key=s.asm.Ob).apply(null,arguments)},s._olm_sas_is_their_key_set=function(){return(s._olm_sas_is_their_key_set=s.asm.Pb).apply(null,arguments)},s._olm_sas_generate_bytes=function(){return(s._olm_sas_generate_bytes=s.asm.Qb).apply(null,arguments)},s._olm_sas_mac_length=function(){return(s._olm_sas_mac_length=s.asm.Rb).apply(null,arguments)},s._olm_sas_calculate_mac_fixed_base64=function(){return(s._olm_sas_calculate_mac_fixed_base64=s.asm.Sb).apply(null,arguments)},s._olm_sas_calculate_mac=function(){return(s._olm_sas_calculate_mac=s.asm.Tb).apply(null,arguments)},s._olm_sas_calculate_mac_long_kdf=function(){return(s._olm_sas_calculate_mac_long_kdf=s.asm.Ub).apply(null,arguments)},s._malloc=function(){return(s._malloc=s.asm.Vb).apply(null,arguments)},s._free=function(){return(s._free=s.asm.Wb).apply(null,arguments)};var ie,le=s.stackSave=function(){return(le=s.stackSave=s.asm.Xb).apply(null,arguments)},ae=s.stackRestore=function(){return(ae=s.stackRestore=s.asm.Yb).apply(null,arguments)},_e=s.stackAlloc=function(){return(_e=s.stackAlloc=s.asm.Zb).apply(null,arguments)};function ce(){function e(){if(!ie&&(ie=!0,s.calledRun=!0,!M)){if(ee(W),l(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;){var e=s.postRun.shift();z.unshift(e)}ee(z)}}if(!(0<q)){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)F();ee(B),0<q||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),e()}),1)):e())}}if(s.UTF8ToString=D,s.stringToUTF8=j,s.intArrayFromString=re,s.writeAsciiToMemory=oe,s.ALLOC_STACK=1,J=function e(){ie||ce(),ie||(J=e)},s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);0<s.preInit.length;)s.preInit.pop()();function ue(){var e=s._olm_outbound_group_session_size();this.ac=Se(e),this.$b=s._olm_outbound_group_session(this.ac)}function pe(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_outbound_group_session_last_error(arguments[0])),Error("OLM."+n);return n}}function me(){var e=s._olm_inbound_group_session_size();this.ac=Se(e),this.$b=s._olm_inbound_group_session(this.ac)}function de(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_inbound_group_session_last_error(arguments[0])),Error("OLM."+n);return n}}function he(){var e=s._olm_pk_encryption_size();this.ac=Se(e),this.$b=s._olm_pk_encryption(this.ac)}function ye(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_pk_encryption_last_error(arguments[0])),Error("OLM."+n);return n}}function ge(){var e=s._olm_pk_decryption_size();this.ac=Se(e),this.$b=s._olm_pk_decryption(this.ac)}function fe(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_pk_decryption_last_error(arguments[0])),Error("OLM."+n);return n}}function be(){var e=s._olm_pk_signing_size();this.ac=Se(e),this.$b=s._olm_pk_signing(this.ac)}function ke(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_pk_signing_last_error(arguments[0])),Error("OLM."+n);return n}}function ve(){var e=s._olm_sas_size(),n=s._olm_create_sas_random_length(),t=Ce(n,_);this.ac=Se(e),this.$b=s._olm_sas(this.ac),s._olm_create_sas(this.$b,t,n),Ie(t,n)}function we(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_sas_last_error(arguments[0])),Error("OLM."+n);return n}}ce(),ue.prototype.free=function(){s._olm_clear_outbound_group_session(this.$b),xe(this.$b)},ue.prototype.pickle=Ue((function(e){e=$e(e);var n=pe(s._olm_pickle_outbound_group_session_length)(this.$b),t=Ee(e),o=Ee(n+1);try{pe(s._olm_pickle_outbound_group_session)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),ue.prototype.unpickle=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n));try{pe(s._olm_unpickle_outbound_group_session)(this.$b,t,e.length,o,n.length)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}})),ue.prototype.create=Ue((function(){var e=pe(s._olm_init_outbound_group_session_random_length)(this.$b),n=Ce(e,_);try{pe(s._olm_init_outbound_group_session)(this.$b,n,e)}finally{Ie(n,e)}})),ue.prototype.encrypt=function(e){try{var n=N(e),t=pe(s._olm_group_encrypt_message_length)(this.$b,n),o=Se(n+1);j(e,o,n+1);var r=Se(t+1);return pe(s._olm_group_encrypt)(this.$b,o,n,r,t),te(r+t),D(r,t)}finally{void 0!==o&&(Ie(o,n+1),xe(o)),void 0!==r&&xe(r)}},ue.prototype.session_id=Ue((function(){var e=pe(s._olm_outbound_group_session_id_length)(this.$b),n=Ee(e+1);return pe(s._olm_outbound_group_session_id)(this.$b,n,e),D(n,e)})),ue.prototype.session_key=Ue((function(){var e=pe(s._olm_outbound_group_session_key_length)(this.$b),n=Ee(e+1);pe(s._olm_outbound_group_session_key)(this.$b,n,e);var t=D(n,e);return Ie(n,e),t})),ue.prototype.message_index=function(){return pe(s._olm_outbound_group_session_message_index)(this.$b)},i.OutboundGroupSession=ue,me.prototype.free=function(){s._olm_clear_inbound_group_session(this.$b),xe(this.$b)},me.prototype.pickle=Ue((function(e){e=$e(e);var n=de(s._olm_pickle_inbound_group_session_length)(this.$b),t=Ee(e),o=Ee(n+1);try{de(s._olm_pickle_inbound_group_session)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),me.prototype.unpickle=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n));try{de(s._olm_unpickle_inbound_group_session)(this.$b,t,e.length,o,n.length)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}})),me.prototype.create=Ue((function(e){var n=Ee(e=$e(e));try{de(s._olm_init_inbound_group_session)(this.$b,n,e.length)}finally{for(Ie(n,e.length),n=0;n<e.length;n++)e[n]=0}})),me.prototype.import_session=Ue((function(e){var n=Ee(e=$e(e));try{de(s._olm_import_inbound_group_session)(this.$b,n,e.length)}finally{for(Ie(n,e.length),n=0;n<e.length;n++)e[n]=0}})),me.prototype.decrypt=Ue((function(e){try{var n=Se(e.length);oe(e,n,!0);var t=de(s._olm_group_decrypt_max_plaintext_length)(this.$b,n,e.length);oe(e,n,!0);var o=Se(t+1),r=Ee(4),i=de(s._olm_group_decrypt)(this.$b,n,e.length,o,t,r);return te(o+i),{plaintext:D(o,i),message_index:ne(r,"i32")}}finally{void 0!==n&&xe(n),void 0!==o&&(Ie(o,i),xe(o))}})),me.prototype.session_id=Ue((function(){var e=de(s._olm_inbound_group_session_id_length)(this.$b),n=Ee(e+1);return de(s._olm_inbound_group_session_id)(this.$b,n,e),D(n,e)})),me.prototype.first_known_index=Ue((function(){return de(s._olm_inbound_group_session_first_known_index)(this.$b)})),me.prototype.export_session=Ue((function(e){var n=de(s._olm_export_inbound_group_session_length)(this.$b),t=Ee(n+1);return pe(s._olm_export_inbound_group_session)(this.$b,t,n,e),e=D(t,n),Ie(t,n),e})),i.InboundGroupSession=me,he.prototype.free=function(){s._olm_clear_pk_encryption(this.$b),xe(this.$b)},he.prototype.set_recipient_key=Ue((function(e){var n=Ee(e=$e(e));ye(s._olm_pk_encryption_set_recipient_key)(this.$b,n,e.length)})),he.prototype.encrypt=Ue((function(e){try{var n=N(e),t=Se(n+1);j(e,t,n+1);var o=ye(s._olm_pk_encrypt_random_length)(),r=Ce(o,_),i=ye(s._olm_pk_ciphertext_length)(this.$b,n),l=Se(i+1),a=ye(s._olm_pk_mac_length)(this.$b),c=Ee(a+1);te(c+a);var u=ye(s._olm_pk_key_length)(),p=Ee(u+1);return te(p+u),ye(s._olm_pk_encrypt)(this.$b,t,n,l,i,c,a,p,u,r,o),te(l+i),{ciphertext:D(l,i),mac:D(c,a),ephemeral:D(p,u)}}finally{void 0!==r&&Ie(r,o),void 0!==t&&(Ie(t,n+1),xe(t)),void 0!==l&&xe(l)}})),ge.prototype.free=function(){s._olm_clear_pk_decryption(this.$b),xe(this.$b)},ge.prototype.init_with_private_key=Ue((function(e){var n=Ee(e.length);s.HEAPU8.set(e,n);var t=fe(s._olm_pk_key_length)(),o=Ee(t+1);try{fe(s._olm_pk_key_from_private)(this.$b,o,t,n,e.length)}finally{Ie(n,e.length)}return D(o,t)})),ge.prototype.generate_key=Ue((function(){var e=fe(s._olm_pk_private_key_length)(),n=Ce(e,_),t=fe(s._olm_pk_key_length)(),o=Ee(t+1);try{fe(s._olm_pk_key_from_private)(this.$b,o,t,n,e)}finally{Ie(n,e)}return D(o,t)})),ge.prototype.get_private_key=Ue((function(){var e=ye(s._olm_pk_private_key_length)(),n=Ee(e);fe(s._olm_pk_get_private_key)(this.$b,n,e);var t=new Uint8Array(new Uint8Array(s.HEAPU8.buffer,n,e));return Ie(n,e),t})),ge.prototype.pickle=Ue((function(e){e=$e(e);var n=fe(s._olm_pickle_pk_decryption_length)(this.$b),t=Ee(e),o=Ee(n+1);try{fe(s._olm_pickle_pk_decryption)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),ge.prototype.unpickle=Ue((function(e,n){var t=Ee(e=$e(e)),o=$e(n),r=Ee(o),i=Ee((n=fe(s._olm_pk_key_length)())+1);try{fe(s._olm_unpickle_pk_decryption)(this.$b,t,e.length,r,o.length,i,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(i,n)})),ge.prototype.decrypt=Ue((function(e,n,t){try{var o=N(t),r=Se(o+1);j(t,r,o+1);var i=$e(e),l=Ee(i),a=$e(n),_=Ee(a),c=fe(s._olm_pk_max_plaintext_length)(this.$b,o),u=Se(c+1),p=fe(s._olm_pk_decrypt)(this.$b,l,i.length,_,a.length,r,o,u,c);return te(u+p),D(u,p)}finally{void 0!==u&&(Ie(u,p+1),xe(u)),void 0!==r&&xe(r)}})),be.prototype.free=function(){s._olm_clear_pk_signing(this.$b),xe(this.$b)},be.prototype.init_with_seed=Ue((function(e){var n=Ee(e.length);s.HEAPU8.set(e,n);var t=ke(s._olm_pk_signing_public_key_length)(),o=Ee(t+1);try{ke(s._olm_pk_signing_key_from_seed)(this.$b,o,t,n,e.length)}finally{Ie(n,e.length)}return D(o,t)})),be.prototype.generate_seed=Ue((function(){var e=ke(s._olm_pk_signing_seed_length)(),n=Ce(e,_),t=new Uint8Array(new Uint8Array(s.HEAPU8.buffer,n,e));return Ie(n,e),t})),be.prototype.sign=Ue((function(e){try{var n=N(e),t=Se(n+1);j(e,t,n+1);var o=ke(s._olm_pk_signature_length)(),r=Ee(o+1);return ke(s._olm_pk_sign)(this.$b,t,n,r,o),D(r,o)}finally{void 0!==t&&(Ie(t,n+1),xe(t))}})),ve.prototype.free=function(){s._olm_clear_sas(this.$b),xe(this.$b)},ve.prototype.get_pubkey=Ue((function(){var e=we(s._olm_sas_pubkey_length)(this.$b),n=Ee(e+1);return we(s._olm_sas_get_pubkey)(this.$b,n,e),D(n,e)})),ve.prototype.set_their_key=Ue((function(e){var n=Ee(e=$e(e));we(s._olm_sas_set_their_key)(this.$b,n,e.length)})),ve.prototype.is_their_key_set=Ue((function(){return!!we(s._olm_sas_is_their_key_set)(this.$b)})),ve.prototype.generate_bytes=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n);return we(s._olm_sas_generate_bytes)(this.$b,t,e.length,o,n),new Uint8Array(new Uint8Array(s.HEAPU8.buffer,o,n))})),ve.prototype.calculate_mac=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n)),r=we(s._olm_sas_mac_length)(this.$b),i=Ee(r+1);return we(s._olm_sas_calculate_mac)(this.$b,t,e.length,o,n.length,i,r),D(i,r)})),ve.prototype.calculate_mac_fixed_base64=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n)),r=we(s._olm_sas_mac_length)(this.$b),i=Ee(r+1);return we(s._olm_sas_calculate_mac_fixed_base64)(this.$b,t,e.length,o,n.length,i,r),D(i,r)})),ve.prototype.calculate_mac_long_kdf=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n)),r=we(s._olm_sas_mac_length)(this.$b),i=Ee(r+1);return we(s._olm_sas_calculate_mac_long_kdf)(this.$b,t,e.length,o,n.length,i,r),D(i,r)}));var Ae,Se=s._malloc,xe=s._free;function Ce(e,n){var t=_e(e);return n(new Uint8Array(s.HEAPU8.buffer,t,e)),t}function Ee(e){return"number"==typeof e?Ce(e,(function(e){e.fill(0)})):Ce(e.length,(function(n){n.set(e)}))}function $e(e){return e instanceof Uint8Array?e:re(e,!0)}function Ue(e){return function(){var n=le();try{return e.apply(this,arguments)}finally{ae(n)}}}function Ie(e,n){for(;0<n--;)s.HEAP8[e++]=0}function Oe(){var e=s._olm_account_size();this.ac=Se(e),this.$b=s._olm_account(this.ac)}function Pe(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_account_last_error(arguments[0])),Error("OLM."+n);return n}}function Re(){var e=s._olm_session_size();this.ac=Se(e),this.$b=s._olm_session(this.ac)}function Me(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_session_last_error(arguments[0])),Error("OLM."+n);return n}}function Te(){var e=s._olm_utility_size();this.ac=Se(e),this.$b=s._olm_utility(this.ac)}function De(e){return function(){var n=e.apply(this,arguments);if(n===Ae)throw n=D(s._olm_utility_last_error(arguments[0])),Error("OLM."+n);return n}}return Oe.prototype.free=function(){s._olm_clear_account(this.$b),xe(this.$b)},Oe.prototype.create=Ue((function(){var e=Pe(s._olm_create_account_random_length)(this.$b),n=Ce(e,_);try{Pe(s._olm_create_account)(this.$b,n,e)}finally{Ie(n,e)}})),Oe.prototype.identity_keys=Ue((function(){var e=Pe(s._olm_account_identity_keys_length)(this.$b),n=Ee(e+1);return Pe(s._olm_account_identity_keys)(this.$b,n,e),D(n,e)})),Oe.prototype.sign=Ue((function(e){var n=Pe(s._olm_account_signature_length)(this.$b),t=Ee(e=$e(e)),o=Ee(n+1);try{Pe(s._olm_account_sign)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),Oe.prototype.one_time_keys=Ue((function(){var e=Pe(s._olm_account_one_time_keys_length)(this.$b),n=Ee(e+1);return Pe(s._olm_account_one_time_keys)(this.$b,n,e),D(n,e)})),Oe.prototype.mark_keys_as_published=Ue((function(){Pe(s._olm_account_mark_keys_as_published)(this.$b)})),Oe.prototype.max_number_of_one_time_keys=Ue((function(){return Pe(s._olm_account_max_number_of_one_time_keys)(this.$b)})),Oe.prototype.generate_one_time_keys=Ue((function(e){var n=Pe(s._olm_account_generate_one_time_keys_random_length)(this.$b,e),t=Ce(n,_);try{Pe(s._olm_account_generate_one_time_keys)(this.$b,e,t,n)}finally{Ie(t,n)}})),Oe.prototype.remove_one_time_keys=Ue((function(e){Pe(s._olm_remove_one_time_keys)(this.$b,e.$b)})),Oe.prototype.generate_fallback_key=Ue((function(){var e=Pe(s._olm_account_generate_fallback_key_random_length)(this.$b),n=Ce(e,_);try{Pe(s._olm_account_generate_fallback_key)(this.$b,n,e)}finally{Ie(n,e)}})),Oe.prototype.fallback_key=Ue((function(){var e=Pe(s._olm_account_fallback_key_length)(this.$b),n=Ee(e+1);return Pe(s._olm_account_fallback_key)(this.$b,n,e),D(n,e)})),Oe.prototype.unpublished_fallback_key=Ue((function(){var e=Pe(s._olm_account_unpublished_fallback_key_length)(this.$b),n=Ee(e+1);return Pe(s._olm_account_unpublished_fallback_key)(this.$b,n,e),D(n,e)})),Oe.prototype.forget_old_fallback_key=Ue((function(){Pe(s._olm_account_forget_old_fallback_key)(this.$b)})),Oe.prototype.pickle=Ue((function(e){e=$e(e);var n=Pe(s._olm_pickle_account_length)(this.$b),t=Ee(e),o=Ee(n+1);try{Pe(s._olm_pickle_account)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),Oe.prototype.unpickle=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n));try{Pe(s._olm_unpickle_account)(this.$b,t,e.length,o,n.length)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}})),Re.prototype.free=function(){s._olm_clear_session(this.$b),xe(this.$b)},Re.prototype.pickle=Ue((function(e){e=$e(e);var n=Me(s._olm_pickle_session_length)(this.$b),t=Ee(e),o=Ee(n+1);try{Me(s._olm_pickle_session)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),Re.prototype.unpickle=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n));try{Me(s._olm_unpickle_session)(this.$b,t,e.length,o,n.length)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}})),Re.prototype.create_outbound=Ue((function(e,n,t){var o=Me(s._olm_create_outbound_session_random_length)(this.$b),r=Ce(o,_);n=$e(n),t=$e(t);var i=Ee(n),l=Ee(t);try{Me(s._olm_create_outbound_session)(this.$b,e.$b,i,n.length,l,t.length,r,o)}finally{Ie(r,o)}})),Re.prototype.create_inbound=Ue((function(e,n){var t=Ee(n=$e(n));try{Me(s._olm_create_inbound_session)(this.$b,e.$b,t,n.length)}finally{for(Ie(t,n.length),e=0;e<n.length;e++)n[e]=0}})),Re.prototype.create_inbound_from=Ue((function(e,n,t){var o=Ee(n=$e(n)),r=Ee(t=$e(t));try{Me(s._olm_create_inbound_session_from)(this.$b,e.$b,o,n.length,r,t.length)}finally{for(Ie(r,t.length),e=0;e<t.length;e++)t[e]=0}})),Re.prototype.session_id=Ue((function(){var e=Me(s._olm_session_id_length)(this.$b),n=Ee(e+1);return Me(s._olm_session_id)(this.$b,n,e),D(n,e)})),Re.prototype.has_received_message=function(){return!!Me(s._olm_session_has_received_message)(this.$b)},Re.prototype.matches_inbound=Ue((function(e){var n=Ee(e=$e(e));return!!Me(s._olm_matches_inbound_session)(this.$b,n,e.length)})),Re.prototype.matches_inbound_from=Ue((function(e,n){var t=Ee(e=$e(e)),o=Ee(n=$e(n));return!!Me(s._olm_matches_inbound_session_from)(this.$b,t,e.length,o,n.length)})),Re.prototype.encrypt=Ue((function(e){try{var n=Me(s._olm_encrypt_random_length)(this.$b),t=Me(s._olm_encrypt_message_type)(this.$b),o=N(e),r=Me(s._olm_encrypt_message_length)(this.$b,o),i=Ce(n,_),l=Se(o+1);j(e,l,o+1);var a=Se(r+1);return Me(s._olm_encrypt)(this.$b,l,o,i,n,a,r),te(a+r),{type:t,body:D(a,r)}}finally{void 0!==i&&Ie(i,n),void 0!==l&&(Ie(l,o+1),xe(l)),void 0!==a&&xe(a)}})),Re.prototype.decrypt=Ue((function(e,n){try{var t=Se(n.length);oe(n,t,!0);var o=Me(s._olm_decrypt_max_plaintext_length)(this.$b,e,t,n.length);oe(n,t,!0);var r=Se(o+1),i=Me(s._olm_decrypt)(this.$b,e,t,n.length,r,o);return te(r+i),D(r,i)}finally{void 0!==t&&xe(t),void 0!==r&&(Ie(r,o),xe(r))}})),Re.prototype.describe=Ue((function(){try{var e=Se(256);return Me(s._olm_session_describe)(this.$b,e,256),D(e)}finally{void 0!==e&&xe(e)}})),Te.prototype.free=function(){s._olm_clear_utility(this.$b),xe(this.$b)},Te.prototype.sha256=Ue((function(e){var n=De(s._olm_sha256_length)(this.$b),t=Ee(e=$e(e)),o=Ee(n+1);try{De(s._olm_sha256)(this.$b,t,e.length,o,n)}finally{for(Ie(t,e.length),t=0;t<e.length;t++)e[t]=0}return D(o,n)})),Te.prototype.ed25519_verify=Ue((function(e,n,t){var o=Ee(e=$e(e)),r=Ee(n=$e(n)),i=Ee(t=$e(t));try{De(s._olm_ed25519_verify)(this.$b,o,e.length,r,n.length,i,t.length)}finally{for(Ie(r,n.length),e=0;e<n.length;e++)n[e]=0}})),i.Account=Oe,i.Session=Re,i.Utility=Te,i.PkEncryption=he,i.PkDecryption=ge,i.PkSigning=be,i.SAS=ve,i.get_library_version=Ue((function(){var e=Ee(3);return s._olm_get_library_version(e,e+1,e+2),[ne(e,"i8"),ne(e+1,"i8"),ne(e+2,"i8")]})),n.ready},"object"==typeof n&&"object"==typeof e?e.exports=l:"function"==typeof define&&define.amd?define([],(function(){return l})):"object"==typeof n&&(n.Module=l),i.init=function(e){return s||(e&&(OLM_OPTIONS=e),s=new Promise((function(e,n){t=function(){e()},o=function(e){n(e)},l()})))},i);"undefined"!=typeof window&&(window.Olm=a),"object"==typeof e&&(e.exports=a)}}]);
//# sourceMappingURL=5727.js.map